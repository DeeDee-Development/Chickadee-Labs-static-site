---
import BaseLayout from '../layouts/BaseLayout.astro';
import PasswordGate from '../components/PasswordGate.astro';
---

<BaseLayout noindex={true}>
  <PasswordGate pageId="architecture">
    <!-- Hero Section -->
    <section class="hero-arch">
    <div class="container">
      <div class="hero-content-arch">
        <h1>System Architecture</h1>
        <p class="hero-subtitle-arch">
          A scalable, privacy-first health monitoring platform built for reliability and performance.
        </p>
      </div>
    </div>
  </section>

  <!-- Architecture Diagram -->
  <section class="section diagram-section">
    <div class="container">
      <h2 class="section-title">System Overview</h2>
      <p class="diagram-instructions">Click and drag to explore ‚Ä¢ Scroll to zoom ‚Ä¢ Click Database to expand ‚Ä¢ Select nodes to highlight connections</p>

      <!-- Legend & Controls -->
      <div class="diagram-controls">
        <div class="legend">
          <div class="legend-title">Legend</div>
          <div class="legend-items">
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #667eea, #764ba2);"></span>
              <span>Users</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #0066EE, #00A8FF);"></span>
              <span>Frontend</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #f093fb, #f5576c);"></span>
              <span>Backend API</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #4facfe, #00f2fe);"></span>
              <span>ML/AI</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #43e97b, #38f9d7);"></span>
              <span>Database</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #ff9a56, #ff6a88);"></span>
              <span>External</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(135deg, #d299c2, #fef9d7);"></span>
              <span>Infrastructure</span>
            </div>
          </div>
        </div>
        <div class="control-buttons">
          <button id="reset-zoom" class="control-btn" title="Reset View">üîÑ Reset</button>
          <button id="fit-view" class="control-btn" title="Fit to View">‚õ∂ Fit</button>
          <button id="export-png" class="control-btn" title="Export as PNG">üì∑ Export</button>
        </div>
      </div>

      <div id="cy" class="architecture-diagram"></div>

      <!-- Database Expansion Modal -->
      <div id="database-modal" class="database-modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>MongoDB Collections</h3>
            <button class="close-modal">‚úï</button>
          </div>

          <div class="collections-grid-modal">
            <div class="collection-card">
              <h4>users</h4>
              <ul>
                <li><code>_id</code>: ObjectId</li>
                <li><code>email</code>: string</li>
                <li><code>created_at</code>: Date</li>
              </ul>
            </div>

            <div class="collection-card">
              <h4>health_metrics</h4>
              <ul>
                <li><code>user_id</code>: ref</li>
                <li><code>metric_type</code>: enum</li>
                <li><code>value</code>: float</li>
              </ul>
            </div>

            <div class="collection-card special">
              <h4>flock (friends) üì∏</h4>
              <ul>
                <li><code>user_id</code>: ref</li>
                <li><code>friend_id</code>: ref</li>
                <li><code>snapshots</code>: array</li>
              </ul>
            </div>

            <div class="collection-card">
              <h4>sms_consent</h4>
              <ul>
                <li><code>phone</code>: string</li>
                <li><code>consent</code>: boolean</li>
                <li><code>updated_at</code>: Date</li>
              </ul>
            </div>

            <div class="collection-card">
              <h4>health_scores</h4>
              <ul>
                <li><code>user_id</code>: ref</li>
                <li><code>score</code>: int (0-100)</li>
                <li><code>risk_level</code>: enum</li>
              </ul>
            </div>

            <div class="collection-card">
              <h4>sessions</h4>
              <ul>
                <li><code>token</code>: string</li>
                <li><code>user_id</code>: ref</li>
                <li><code>expires_at</code>: Date</li>
              </ul>
            </div>
          </div>

          <div class="storage-pattern">
            <h4>üí° Storage Pattern: Flock Snapshots</h4>
            <p>The <strong>flock</strong> collection uses a snapshot pattern to maintain historical friend relationships. Each relationship includes an array of timestamped snapshots capturing permission changes, health sharing settings, and connection status over time‚Äîenabling audit trails and rollback capability.</p>
          </div>
        </div>
      </div>

      <!-- Old SVG diagram kept below for reference, will remove later -->
      <div class="old-diagram" style="display: none;">
        <svg viewBox="0 0 1200 1000" xmlns="http://www.w3.org/2000/svg">
          <!-- Definitions -->
          <defs>
            <!-- iOS Liquid Glass Shadow Effect -->
            <filter id="liquidGlass" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="3" result="blur1"/>
              <feOffset in="blur1" dx="0" dy="4" result="offsetBlur1"/>
              <feFlood flood-color="#000000" flood-opacity="0.1" result="color1"/>
              <feComposite in="color1" in2="offsetBlur1" operator="in" result="shadow1"/>

              <feGaussianBlur in="SourceAlpha" stdDeviation="8" result="blur2"/>
              <feOffset in="blur2" dx="0" dy="8" result="offsetBlur2"/>
              <feFlood flood-color="#000000" flood-opacity="0.08" result="color2"/>
              <feComposite in="color2" in2="offsetBlur2" operator="in" result="shadow2"/>

              <feGaussianBlur in="SourceAlpha" stdDeviation="1" result="blur3"/>
              <feOffset in="blur3" dx="0" dy="1" result="offsetBlur3"/>
              <feFlood flood-color="#ffffff" flood-opacity="0.5" result="color3"/>
              <feComposite in="color3" in2="offsetBlur3" operator="in" result="innerGlow"/>

              <feMerge>
                <feMergeNode in="shadow2"/>
                <feMergeNode in="shadow1"/>
                <feMergeNode in="SourceGraphic"/>
                <feMergeNode in="innerGlow"/>
              </feMerge>
            </filter>

            <!-- Subtle shadow for user boxes -->
            <filter id="userShadow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/>
              <feOffset in="blur" dx="0" dy="6" result="offsetBlur"/>
              <feFlood flood-color="#000000" flood-opacity="0.12" result="color"/>
              <feComposite in="color" in2="offsetBlur" operator="in" result="shadow"/>
              <feMerge>
                <feMergeNode in="shadow"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>

            <linearGradient id="blueGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#0066EE;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#0052CC;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="purpleGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#9383FB;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#7B68EE;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="greenGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#00C853;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#00A843;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#FF6B35;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#E65527;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="tealGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#00BCD4;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#0097A7;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="pinkGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#E91E63;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#C2185B;stop-opacity:1" />
            </linearGradient>

            <!-- Arrow markers with different colors -->
            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#666" />
            </marker>
            <marker id="arrowheadAlert" markerWidth="12" markerHeight="12" refX="10" refY="3.5" orient="auto">
              <polygon points="0 0, 12 3.5, 0 7" fill="#FF6B35" />
            </marker>
            <marker id="arrowheadUser" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#999" />
            </marker>
          </defs>

          <!-- Title -->
          <text x="600" y="30" text-anchor="middle" class="diagram-title">DeeDee Health Platform Architecture</text>

          <!-- Layer 1: Client Layer -->
          <g class="layer-group">
            <text x="100" y="80" class="layer-label">Client Layer</text>
            <rect x="100" y="100" width="200" height="140" rx="8" fill="url(#blueGradient)" class="component-box" filter="url(#liquidGlass)" />
            <text x="200" y="130" text-anchor="middle" class="component-title">iOS App</text>
            <text x="200" y="155" text-anchor="middle" class="component-subtitle">Swift / SwiftUI</text>
            <g class="component-details">
              <text x="120" y="180" class="detail-text">‚Ä¢ Health Data: HealthKit</text>
              <text x="120" y="200" class="detail-text">‚Ä¢ App Data: SwiftData</text>
              <text x="120" y="220" class="detail-text">‚Ä¢ Apple Watch Sync</text>
            </g>
          </g>

          <!-- Layer 1: Web Client -->
          <g class="layer-group">
            <rect x="350" y="100" width="200" height="140" rx="8" fill="url(#purpleGradient)" class="component-box" filter="url(#liquidGlass)" />
            <text x="450" y="130" text-anchor="middle" class="component-title">Static Website</text>
            <text x="450" y="155" text-anchor="middle" class="component-subtitle">Astro / TypeScript</text>
            <g class="component-details">
              <text x="370" y="180" class="detail-text">‚Ä¢ Marketing Pages</text>
              <text x="370" y="200" class="detail-text">‚Ä¢ SMS Opt-In Portal</text>
              <text x="370" y="220" class="detail-text">‚Ä¢ GitHub Pages</text>
            </g>
          </g>

          <!-- Arrow: iOS App ‚Üí Backend -->
          <path d="M 200 240 Q 200 280, 200 340" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)" class="data-flow" />
          <text x="220" y="290" class="flow-label">Health Data</text>

          <!-- Arrow: Website ‚Üí Backend -->
          <path d="M 450 240 Q 450 280, 450 340" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)" class="data-flow" />
          <text x="470" y="290" class="flow-label">SMS Opt-In</text>

          <!-- Layer 2: API Layer -->
          <g class="layer-group">
            <text x="100" y="310" class="layer-label">API Layer</text>
            <rect x="100" y="340" width="450" height="180" rx="8" fill="url(#blueGradient)" class="component-box" filter="url(#liquidGlass)" />
            <text x="325" y="375" text-anchor="middle" class="component-title">Backend API</text>
            <text x="325" y="400" text-anchor="middle" class="component-subtitle">Python / FastAPI</text>
            <g class="component-details">
              <text x="120" y="430" class="detail-text">‚Ä¢ RESTful API Endpoints</text>
              <text x="120" y="450" class="detail-text">‚Ä¢ Health Data Processing</text>
              <text x="120" y="470" class="detail-text">‚Ä¢ Fall Risk Analysis Engine</text>
              <text x="120" y="490" class="detail-text">‚Ä¢ Google Cloud Run Deployment</text>
            </g>
          </g>

          <!-- Layer 3: Data & Services Layer -->
          <g class="layer-group">
            <text x="100" y="560" class="layer-label">Data & Services</text>

            <!-- Database (clickable) -->
            <g id="database-box" class="clickable-box" style="cursor: pointer;">
              <rect x="100" y="590" width="180" height="140" rx="8" fill="url(#greenGradient)" class="component-box" filter="url(#liquidGlass)" />
              <text x="190" y="620" text-anchor="middle" class="component-title">Database</text>
              <text x="190" y="645" text-anchor="middle" class="component-subtitle">MongoDB</text>
              <g class="component-details">
                <text x="120" y="670" class="detail-text">‚Ä¢ User Profiles</text>
                <text x="120" y="690" class="detail-text">‚Ä¢ Health Metrics</text>
                <text x="120" y="710" class="detail-text">‚Ä¢ SMS Consent</text>
              </g>
              <!-- Click indicator -->
              <text x="270" y="605" class="click-hint" fill="#00C853" font-size="12" font-weight="600">‚ñº</text>
            </g>

            <!-- Expanded Database Details (hidden by default) -->
            <g id="database-expanded" style="display: none;">
              <!-- Expanded container -->
              <rect x="80" y="580" width="520" height="400" rx="12" fill="#f8f9fa" stroke="#00C853" stroke-width="2" filter="url(#liquidGlass)" />

              <!-- Close button -->
              <circle cx="580" cy="600" r="12" fill="#00C853" class="close-btn" style="cursor: pointer;" />
              <text x="580" y="605" text-anchor="middle" fill="white" font-size="14" font-weight="bold" class="close-btn" style="cursor: pointer;">‚úï</text>

              <!-- Title -->
              <text x="340" y="615" text-anchor="middle" class="expanded-title">MongoDB Collections</text>

              <!-- Collections Grid -->
              <g class="collections-grid">
                <!-- Users Collection -->
                <g class="collection-item">
                  <rect x="100" y="640" width="140" height="80" rx="6" fill="white" stroke="#00C853" stroke-width="1.5" />
                  <text x="170" y="660" text-anchor="middle" class="collection-name">users</text>
                  <text x="110" y="680" class="collection-field">‚Ä¢ _id: ObjectId</text>
                  <text x="110" y="695" class="collection-field">‚Ä¢ email: string</text>
                  <text x="110" y="710" class="collection-field">‚Ä¢ created_at: Date</text>
                </g>

                <!-- Health Metrics Collection -->
                <g class="collection-item">
                  <rect x="260" y="640" width="140" height="80" rx="6" fill="white" stroke="#00C853" stroke-width="1.5" />
                  <text x="330" y="660" text-anchor="middle" class="collection-name">health_metrics</text>
                  <text x="270" y="680" class="collection-field">‚Ä¢ user_id: ref</text>
                  <text x="270" y="695" class="collection-field">‚Ä¢ metric_type: enum</text>
                  <text x="270" y="710" class="collection-field">‚Ä¢ value: float</text>
                </g>

                <!-- Flock (Friends) Collection -->
                <g class="collection-item">
                  <rect x="420" y="640" width="160" height="80" rx="6" fill="white" stroke="#9383FB" stroke-width="2" />
                  <text x="500" y="660" text-anchor="middle" class="collection-name special">flock (friends)</text>
                  <text x="430" y="680" class="collection-field">‚Ä¢ user_id: ref</text>
                  <text x="430" y="695" class="collection-field">‚Ä¢ friend_id: ref</text>
                  <text x="430" y="710" class="collection-field">‚Ä¢ snapshots: array üì∏</text>
                </g>

                <!-- SMS Consent Collection -->
                <g class="collection-item">
                  <rect x="100" y="740" width="140" height="80" rx="6" fill="white" stroke="#00C853" stroke-width="1.5" />
                  <text x="170" y="760" text-anchor="middle" class="collection-name">sms_consent</text>
                  <text x="110" y="780" class="collection-field">‚Ä¢ phone: string</text>
                  <text x="110" y="795" class="collection-field">‚Ä¢ consent: boolean</text>
                  <text x="110" y="810" class="collection-field">‚Ä¢ updated_at: Date</text>
                </g>

                <!-- Health Scores Collection -->
                <g class="collection-item">
                  <rect x="260" y="740" width="140" height="80" rx="6" fill="white" stroke="#00C853" stroke-width="1.5" />
                  <text x="330" y="760" text-anchor="middle" class="collection-name">health_scores</text>
                  <text x="270" y="780" class="collection-field">‚Ä¢ user_id: ref</text>
                  <text x="270" y="795" class="collection-field">‚Ä¢ score: int (0-100)</text>
                  <text x="270" y="810" class="collection-field">‚Ä¢ risk_level: enum</text>
                </g>

                <!-- Sessions Collection -->
                <g class="collection-item">
                  <rect x="420" y="740" width="160" height="80" rx="6" fill="white" stroke="#00C853" stroke-width="1.5" />
                  <text x="500" y="760" text-anchor="middle" class="collection-name">sessions</text>
                  <text x="430" y="780" class="collection-field">‚Ä¢ token: string</text>
                  <text x="430" y="795" class="collection-field">‚Ä¢ user_id: ref</text>
                  <text x="430" y="810" class="collection-field">‚Ä¢ expires_at: Date</text>
                </g>
              </g>

              <!-- Storage Pattern Note -->
              <g class="storage-note">
                <rect x="100" y="840" width="480" height="110" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="1.5" />
                <text x="340" y="860" text-anchor="middle" class="note-title">üí° Storage Pattern: Flock Snapshots</text>
                <text x="110" y="885" class="note-text">The <tspan font-weight="600">flock</tspan> collection uses a snapshot pattern to maintain historical</text>
                <text x="110" y="905" class="note-text">friend relationships. Each relationship includes an array of timestamped</text>
                <text x="110" y="925" class="note-text">snapshots capturing permission changes, health sharing settings, and</text>
                <text x="110" y="945" class="note-text">connection status over time‚Äîenabling audit trails and rollback capability.</text>
              </g>
            </g>

            <!-- SMS Service -->
            <rect x="320" y="590" width="180" height="140" rx="8" fill="url(#orangeGradient)" class="component-box" filter="url(#liquidGlass)" />
            <text x="410" y="620" text-anchor="middle" class="component-title">SMS Service</text>
            <text x="410" y="645" text-anchor="middle" class="component-subtitle">Telnyx API</text>
            <g class="component-details">
              <text x="340" y="670" class="detail-text">‚Ä¢ Alert Delivery</text>
              <text x="340" y="690" class="detail-text">‚Ä¢ Rate Limiting</text>
              <text x="340" y="710" class="detail-text">‚Ä¢ Delivery Tracking</text>
            </g>
          </g>

          <!-- Arrow: Backend ‚Üí Database -->
          <path d="M 190 520 Q 190 550, 190 590" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)" class="data-flow" />
          <text x="145" y="555" class="flow-label">Store/Query</text>

          <!-- Arrow: Backend ‚Üí SMS -->
          <path d="M 410 520 Q 410 550, 410 590" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)" class="data-flow" />
          <text x="430" y="555" class="flow-label">Send Alerts</text>

          <!-- Layer 4: Users -->
          <g class="layer-group">
            <text x="650" y="80" class="layer-label">End Users</text>

            <!-- Senior User -->
            <rect x="650" y="100" width="200" height="110" rx="8" fill="url(#tealGradient)" class="component-box" filter="url(#userShadow)" />
            <text x="750" y="130" text-anchor="middle" class="component-title">Senior</text>
            <g class="component-details">
              <text x="670" y="160" class="detail-text">‚Ä¢ Uses iOS App</text>
              <text x="670" y="180" class="detail-text">‚Ä¢ Wears Apple Watch</text>
              <text x="670" y="200" class="detail-text">‚Ä¢ Health Data Source</text>
            </g>

            <!-- Caregiver User -->
            <rect x="650" y="240" width="200" height="110" rx="8" fill="url(#pinkGradient)" class="component-box" filter="url(#userShadow)" />
            <text x="750" y="270" text-anchor="middle" class="component-title">Family Caregiver</text>
            <g class="component-details">
              <text x="670" y="300" class="detail-text">‚Ä¢ Receives SMS Alerts</text>
              <text x="670" y="320" class="detail-text">‚Ä¢ Opts In via Website</text>
              <text x="670" y="340" class="detail-text">‚Ä¢ Monitors Loved Ones</text>
            </g>
          </g>

          <!-- Arrow: Senior ‚Üí iOS App (curved right to left) -->
          <path d="M 650 155 Q 475 145, 300 155" stroke="#999" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowheadUser)" class="data-flow" />

          <!-- Arrow: Caregiver ‚Üí Website (curved diagonal) -->
          <path d="M 650 270 Q 600 220, 550 170" stroke="#999" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowheadUser)" class="data-flow" />

          <!-- Arrow: SMS Service ‚Üí Caregiver (smart routing around backend) -->
          <path d="M 500 660 Q 580 600, 580 520 Q 580 440, 600 380 Q 610 340, 650 310" stroke="#FF6B35" stroke-width="3" fill="none" marker-end="url(#arrowheadAlert)" class="data-flow alert-flow" />
          <text x="585" y="450" class="flow-label alert-label">üö® Fall Risk Alert</text>

          <!-- Cloud Infrastructure -->
          <rect x="620" y="760" width="520" height="230" rx="12" fill="none" stroke="#ccc" stroke-width="2" stroke-dasharray="10,5" class="cloud-boundary" />
          <text x="880" y="785" text-anchor="middle" class="cloud-label">Google Cloud Platform</text>

          <!-- GCP Services -->
          <g class="gcp-services">
            <rect x="640" y="810" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="710" y="835" text-anchor="middle" class="service-text">Cloud Run</text>
            <text x="710" y="855" text-anchor="middle" class="service-subtext">(API Hosting)</text>

            <rect x="800" y="810" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="870" y="835" text-anchor="middle" class="service-text">MongoDB Atlas</text>
            <text x="870" y="855" text-anchor="middle" class="service-subtext">(Database)</text>

            <rect x="960" y="810" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="1030" y="835" text-anchor="middle" class="service-text">Secret Manager</text>
            <text x="1030" y="855" text-anchor="middle" class="service-subtext">(API Keys)</text>

            <rect x="640" y="900" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="710" y="925" text-anchor="middle" class="service-text">Cloud Logging</text>
            <text x="710" y="945" text-anchor="middle" class="service-subtext">(Monitoring)</text>

            <rect x="800" y="900" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="870" y="925" text-anchor="middle" class="service-text">Cloud Build</text>
            <text x="870" y="945" text-anchor="middle" class="service-subtext">(CI/CD)</text>

            <rect x="960" y="900" width="140" height="60" rx="6" fill="#fff" stroke="#ccc" stroke-width="1" />
            <text x="1030" y="925" text-anchor="middle" class="service-text">IAM</text>
            <text x="1030" y="945" text-anchor="middle" class="service-subtext">(Security)</text>
          </g>
        </svg>
      </div>
    </div>
    </div>
  </section>

  <!-- Technology Stack -->
  <section class="section section-alt">
    <div class="container">
      <h2 class="section-title">Technology Stack</h2>

      <div class="grid grid-3">
        <div class="card tech-card">
          <h3>üì± iOS Application</h3>
          <ul class="tech-list">
            <li><strong>Language:</strong> Swift 5.9+</li>
            <li><strong>UI Framework:</strong> SwiftUI</li>
            <li><strong>Health Data:</strong> HealthKit API</li>
            <li><strong>Watch Integration:</strong> WatchConnectivity</li>
            <li><strong>Health Storage:</strong> HealthKit</li>
            <li><strong>App Data:</strong> SwiftData</li>
            <li><strong>Networking:</strong> URLSession / Async/Await</li>
          </ul>
        </div>

        <div class="card tech-card">
          <h3>üöÄ Backend API</h3>
          <ul class="tech-list">
            <li><strong>Language:</strong> Python 3.11+</li>
            <li><strong>Framework:</strong> FastAPI</li>
            <li><strong>Hosting:</strong> Google Cloud Run</li>
            <li><strong>Container:</strong> Docker</li>
            <li><strong>Database:</strong> MongoDB</li>
            <li><strong>SMS:</strong> <a href="https://telnyx.com/" target="_blank" rel="noopener noreferrer">Telnyx API</a></li>
            <li><strong>Auth:</strong> JWT Tokens</li>
          </ul>
        </div>

        <div class="card tech-card">
          <h3>üåê Static Website</h3>
          <ul class="tech-list">
            <li><strong>Framework:</strong> Astro 5.x</li>
            <li><strong>Language:</strong> TypeScript</li>
            <li><strong>Styling:</strong> CSS Variables</li>
            <li><strong>Hosting:</strong> GitHub Pages</li>
            <li><strong>Domain:</strong> chickadee.family</li>
            <li><strong>CI/CD:</strong> GitHub Actions</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Key Features -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Architectural Highlights</h2>

      <div class="grid grid-2">
        <div class="card feature-card-arch">
          <div class="feature-icon-arch">üîí</div>
          <h3>Privacy-First Design</h3>
          <p>Health data is encrypted in transit and at rest. HIPAA-compliant infrastructure with role-based access controls. Users maintain full ownership of their health data.</p>
        </div>

        <div class="card feature-card-arch">
          <div class="feature-icon-arch">‚ö°</div>
          <h3>Serverless Architecture</h3>
          <p>Cloud Run provides automatic scaling from zero to production traffic. Pay only for actual compute time. No server maintenance overhead.</p>
        </div>

        <div class="card feature-card-arch">
          <div class="feature-icon-arch">üîÑ</div>
          <h3>Real-Time Processing</h3>
          <p>Health data analyzed continuously with sub-minute latency. Fall risk algorithms detect patterns across multiple health dimensions simultaneously.</p>
        </div>

        <div class="card feature-card-arch">
          <div class="feature-icon-arch">üìä</div>
          <h3>Observable System</h3>
          <p>Comprehensive logging and monitoring via Cloud Logging and Cloud Trace. Alert delivery tracking and API performance metrics in real-time.</p>
        </div>

        <div class="card feature-card-arch">
          <div class="feature-icon-arch">üß™</div>
          <h3>Continuous Deployment</h3>
          <p>Automated CI/CD pipeline with GitHub Actions and Cloud Build. Automated testing, container builds, and zero-downtime deployments.</p>
        </div>

        <div class="card feature-card-arch">
          <div class="feature-icon-arch">üåç</div>
          <h3>Global Availability</h3>
          <p>Multi-region deployment for high availability. CDN-backed static site with 99.9% uptime SLA. SMS delivery to 100+ countries via Telnyx.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Health Score Calculation -->
  <section class="section section-alt">
    <div class="container">
      <h2 class="section-title">Health Score Calculation Pipeline</h2>
      <p class="subsection-intro">Our proprietary algorithm transforms raw sensor data into actionable health insights through a multi-stage processing pipeline.</p>

      <div class="mermaid-container">
        <pre class="mermaid">
graph LR
    subgraph "Sensor Data Collection"
        W1[Apple Watch<br/>Gait Asymmetry<br/>1Hz]
        W2[Apple Watch<br/>Heart Rate Variability<br/>1-5 min intervals]
        W3[Apple Watch<br/>Sleep Stages<br/>Nightly]
        I1[iPhone<br/>Step Count<br/>Hourly]
        I2[iPhone<br/>Walking Speed<br/>Continuous]
        H1[HealthKit<br/>Active Energy<br/>Daily]
        H2[HealthKit<br/>Exercise Minutes<br/>Daily]
    end

    subgraph "Normalization Layer"
        N[Time-Series Resampling<br/>15-minute intervals<br/>Forward-fill, Interpolate, Nulls]
    end

    subgraph "Confidence Scoring"
        C1[Data Recency<br/>Exponential Decay]
        C2[Sample Count<br/>Min 3 required]
        C3[Device Type<br/>Watch vs iPhone]
        CS[Confidence Score<br/>0.0 - 1.0]
    end

    subgraph "Weighted Ensemble"
        M1[Gait Metrics<br/>40% weight]
        M2[Activity Patterns<br/>25% weight]
        M3[Sleep Quality<br/>20% weight]
        M4[Vitals<br/>15% weight]
    end

    subgraph "Output"
        HS[Health Score<br/>0-100]
        RL[Risk Level<br/>Green/Yellow/Red]
    end

    W1 --> N
    W2 --> N
    W3 --> N
    I1 --> N
    I2 --> N
    H1 --> N
    H2 --> N

    N --> C1
    N --> C2
    N --> C3
    C1 --> CS
    C2 --> CS
    C3 --> CS

    CS --> M1
    CS --> M2
    CS --> M3
    CS --> M4

    M1 --> HS
    M2 --> HS
    M3 --> HS
    M4 --> HS

    HS --> RL

    classDef sensor fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef processing fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef output fill:#e8f5e9,stroke:#388e3c,stroke-width:2px

    class W1,W2,W3,I1,I2,H1,H2 sensor
    class N,C1,C2,C3,CS,M1,M2,M3,M4 processing
    class HS,RL output
        </pre>
      </div>

      <div class="calculation-details">
        <h3>Algorithm Details</h3>
        <div class="grid grid-2">
          <div class="detail-box">
            <h4>Data Sources</h4>
            <ul>
              <li><strong>Apple Watch:</strong> Gait asymmetry (1Hz), HRV (1-5 min), sleep stages</li>
              <li><strong>iPhone:</strong> Step count (hourly), walking speed (continuous)</li>
              <li><strong>HealthKit:</strong> Active energy, exercise minutes</li>
            </ul>
          </div>

          <div class="detail-box">
            <h4>Normalization</h4>
            <ul>
              <li><strong>Resampling:</strong> 15-minute intervals</li>
              <li><strong>Gap Filling:</strong> Forward-fill with interpolation</li>
              <li><strong>Missing Data:</strong> Handled with confidence scoring</li>
            </ul>
          </div>

          <div class="detail-box">
            <h4>Confidence Factors</h4>
            <ul>
              <li><strong>Recency:</strong> Exponential decay for older data</li>
              <li><strong>Sample Size:</strong> Minimum 3 data points required</li>
              <li><strong>Device Priority:</strong> Apple Watch > iPhone</li>
            </ul>
          </div>

          <div class="detail-box">
            <h4>Weighted Ensemble</h4>
            <ul>
              <li><strong>Gait Metrics:</strong> 40% (strongest fall predictor)</li>
              <li><strong>Activity Patterns:</strong> 25%</li>
              <li><strong>Sleep Quality:</strong> 20%</li>
              <li><strong>Vitals (HRV):</strong> 15%</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Data Flow -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Data Flow & Processing</h2>

      <div class="data-flow-content">
        <div class="flow-step">
          <div class="flow-number">1</div>
          <div class="flow-description">
            <h3>Data Collection</h3>
            <p>iOS app uses HealthKit to securely access Apple Watch and iPhone health metrics: sleep quality, walking speed, heart rate variability, daily activity, and energy levels.</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-number">2</div>
          <div class="flow-description">
            <h3>Secure Transmission</h3>
            <p>Health data transmitted via HTTPS with TLS 1.3 encryption. JWT-based authentication ensures only authorized devices can submit data. Rate limiting prevents abuse.</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-number">3</div>
          <div class="flow-description">
            <h3>Risk Analysis</h3>
            <p>Backend analyzes health patterns using multi-factor risk scoring algorithm. Detects declining mobility, poor sleep patterns, reduced activity, and other fall risk indicators.</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-number">4</div>
          <div class="flow-description">
            <h3>Alert Generation</h3>
            <p>When risk thresholds are exceeded, system generates alerts with context. Respects user notification preferences and consent settings stored in database.</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-number">5</div>
          <div class="flow-description">
            <h3>Caregiver Notification</h3>
            <p>SMS alerts delivered to family caregivers via Twilio API with delivery tracking. Includes actionable information about detected health changes.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Security & Compliance -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Security & Compliance</h2>

      <div class="security-content">
        <div class="security-grid">
          <div class="security-item">
            <h4>üõ°Ô∏è Data Encryption</h4>
            <p>End-to-end encryption for all health data in transit (TLS 1.3) and at rest (AES-256). No plaintext storage of sensitive information.</p>
          </div>

          <div class="security-item">
            <h4>üîê Authentication & Authorization</h4>
            <p>JWT-based authentication with short-lived tokens. Role-based access control (RBAC) ensures users only access their own data.</p>
          </div>

          <div class="security-item">
            <h4>üìã HIPAA Compliance</h4>
            <p>Google Cloud Platform HIPAA-compliant infrastructure. Business Associate Agreement (BAA) in place. Audit logging for all health data access.</p>
          </div>

          <div class="security-item">
            <h4>üîí Secret Management</h4>
            <p>API keys and credentials stored in Google Cloud Secret Manager. No secrets in code or environment variables. Automatic rotation supported.</p>
          </div>

          <div class="security-item">
            <h4>üìä Monitoring & Incident Response</h4>
            <p>Real-time security monitoring via Cloud Logging. Automated alerting for anomalous access patterns. Incident response procedures documented.</p>
          </div>

          <div class="security-item">
            <h4>‚úÖ Consent Management</h4>
            <p>Explicit opt-in required for SMS alerts. Users can withdraw consent anytime. Consent history tracked for compliance audit trails.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Performance & Scalability -->
  <section class="section section-alt">
    <div class="container">
      <h2 class="section-title">Performance & Scalability</h2>

      <div class="perf-metrics">
        <div class="metric-card">
          <div class="metric-value">&lt;100ms</div>
          <div class="metric-label">API Response Time (P95)</div>
        </div>

        <div class="metric-card">
          <div class="metric-value">99.9%</div>
          <div class="metric-label">Uptime SLA</div>
        </div>

        <div class="metric-card">
          <div class="metric-value">10K+</div>
          <div class="metric-label">Concurrent Users (Supported)</div>
        </div>

        <div class="metric-card">
          <div class="metric-value">&lt;2 min</div>
          <div class="metric-label">Alert Delivery Time</div>
        </div>
      </div>

      <div class="scalability-description">
        <h3>Horizontal Scaling Strategy</h3>
        <p>Cloud Run automatically scales container instances based on incoming traffic. Each instance handles thousands of concurrent requests. Database connection pooling prevents bottlenecks. SMS delivery queued for reliable processing during traffic spikes.</p>
      </div>
    </div>
  </section>

  <!-- Future Roadmap -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Technical Roadmap</h2>

      <div class="roadmap-content">
        <div class="roadmap-item">
          <h4>Q1 2025: Machine Learning Integration</h4>
          <p>Deploy ML models for personalized fall risk prediction. Train on historical health data patterns. Integrate TensorFlow Lite for on-device inference.</p>
        </div>

        <div class="roadmap-item">
          <h4>Q2 2025: Android Support</h4>
          <p>Kotlin-based Android app using Google Fit API. Shared backend infrastructure. Cross-platform health data normalization.</p>
        </div>

        <div class="roadmap-item">
          <h4>Q3 2025: Advanced Analytics Dashboard</h4>
          <p>Web-based caregiver portal with historical trends. Data visualization using D3.js. Export functionality for healthcare providers.</p>
        </div>

        <div class="roadmap-item">
          <h4>Q4 2025: Multi-Language Support</h4>
          <p>Internationalization (i18n) for iOS app and website. SMS alerts in user's preferred language. Support for 10+ languages initially.</p>
        </div>
      </div>
    </div>
  </section>
  </PasswordGate>
</BaseLayout>

<style>
  /* Hero Section */
  .hero-arch {
    background: linear-gradient(135deg, #0066EE 0%, #9383FB 100%);
    color: white;
    padding: var(--space-3xl) 0;
    text-align: center;
  }

  .hero-content-arch {
    max-width: 800px;
    margin: 0 auto;
  }

  .hero-arch h1 {
    font-size: var(--font-size-5xl);
    color: white;
    margin-bottom: var(--space-lg);
  }

  .hero-subtitle-arch {
    font-size: var(--font-size-xl);
    color: rgba(255, 255, 255, 0.9);
    line-height: var(--line-height-relaxed);
  }

  /* Section Title */
  .section-title {
    text-align: center;
    margin-bottom: var(--space-3xl);
    font-size: var(--font-size-3xl);
  }

  /* Architecture Diagram */
  .diagram-section {
    background: white;
  }

  .architecture-diagram {
    background: #f8f9fa;
    border-radius: 12px;
    padding: var(--space-xl);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .architecture-diagram svg {
    width: 100%;
    height: auto;
    display: block;
  }

  /* SVG Text Styles */
  .diagram-title {
    font-size: 24px;
    font-weight: 700;
    fill: #1a1a1a;
  }

  .layer-label {
    font-size: 14px;
    font-weight: 600;
    fill: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .component-title {
    font-size: 18px;
    font-weight: 700;
    fill: white;
  }

  .component-subtitle {
    font-size: 13px;
    font-weight: 500;
    fill: rgba(255, 255, 255, 0.9);
  }

  .detail-text {
    font-size: 12px;
    fill: rgba(255, 255, 255, 0.95);
  }

  .flow-label {
    font-size: 12px;
    font-weight: 600;
    fill: #666;
  }

  .alert-label {
    font-size: 13px;
    font-weight: 700;
    fill: #FF6B35;
  }

  .cloud-label {
    font-size: 16px;
    font-weight: 600;
    fill: #666;
  }

  .service-text {
    font-size: 13px;
    font-weight: 600;
    fill: #333;
  }

  .service-subtext {
    font-size: 11px;
    fill: #666;
  }

  .component-box {
    /* iOS liquid glass shadow applied via SVG filter */
  }

  .data-flow {
    opacity: 0.8;
    transition: opacity 0.3s ease, stroke-width 0.3s ease;
  }

  .data-flow:hover {
    opacity: 1;
    stroke-width: 3 !important;
  }

  .alert-flow {
    opacity: 1;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  /* Clickable Database Box */
  .clickable-box {
    transition: transform 0.2s ease;
  }

  .clickable-box:hover {
    transform: scale(1.02);
  }

  .click-hint {
    animation: bounce 2s ease-in-out infinite;
  }

  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-3px);
    }
  }

  /* Expanded Database View */
  .expanded-title {
    font-size: 18px;
    font-weight: 700;
    fill: #00C853;
  }

  .collection-name {
    font-size: 13px;
    font-weight: 700;
    fill: #333;
  }

  .collection-name.special {
    fill: #9383FB;
  }

  .collection-field {
    font-size: 11px;
    fill: #666;
  }

  .note-title {
    font-size: 14px;
    font-weight: 700;
    fill: #f57c00;
  }

  .note-text {
    font-size: 11px;
    fill: #666;
    line-height: 1.6;
  }

  .close-btn:hover {
    opacity: 0.8;
  }

  /* Collection Items Hover */
  .collection-item rect {
    transition: transform 0.2s ease, stroke-width 0.2s ease;
  }

  .collection-item:hover rect {
    transform: scale(1.05);
    stroke-width: 2.5px;
  }

  /* Tech Cards */
  .tech-card {
    text-align: left;
  }

  .tech-card h3 {
    font-size: var(--font-size-xl);
    margin-bottom: var(--space-md);
  }

  .tech-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .tech-list li {
    padding: var(--space-xs) 0;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
  }

  .tech-list strong {
    color: var(--color-text);
    font-weight: var(--font-weight-semibold);
  }

  /* Feature Cards */
  .feature-card-arch {
    text-align: center;
  }

  .feature-icon-arch {
    font-size: var(--font-size-4xl);
    margin-bottom: var(--space-md);
  }

  .feature-card-arch h3 {
    font-size: var(--font-size-xl);
    margin-bottom: var(--space-sm);
  }

  .feature-card-arch p {
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
  }

  /* Data Flow Steps */
  .data-flow-content {
    max-width: 900px;
    margin: 0 auto;
  }

  .flow-step {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
    align-items: start;
  }

  .flow-number {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, #0066EE 0%, #9383FB 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    flex-shrink: 0;
  }

  .flow-description h3 {
    margin-bottom: var(--space-sm);
    font-size: var(--font-size-lg);
  }

  .flow-description p {
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  /* Security Grid */
  .security-content {
    max-width: 1000px;
    margin: 0 auto;
  }

  .security-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-xl);
  }

  .security-item h4 {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-sm);
    color: var(--color-primary);
  }

  .security-item p {
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  /* Performance Metrics */
  .perf-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-xl);
    margin-bottom: var(--space-3xl);
  }

  .metric-card {
    text-align: center;
    padding: var(--space-xl);
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .metric-value {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin-bottom: var(--space-sm);
  }

  .metric-label {
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
  }

  .scalability-description {
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
  }

  .scalability-description h3 {
    font-size: var(--font-size-2xl);
    margin-bottom: var(--space-md);
  }

  .scalability-description p {
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
    font-size: var(--font-size-lg);
  }

  /* Roadmap */
  .roadmap-content {
    max-width: 900px;
    margin: 0 auto;
  }

  .roadmap-item {
    padding: var(--space-xl);
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: var(--space-lg);
    border-left: 4px solid var(--color-primary);
  }

  .roadmap-item h4 {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-sm);
    color: var(--color-primary);
  }

  .roadmap-item p {
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  /* Mermaid Diagram */
  .subsection-intro {
    text-align: center;
    max-width: 800px;
    margin: 0 auto var(--space-2xl);
    font-size: var(--font-size-lg);
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
  }

  .mermaid-container {
    background: white;
    border-radius: 12px;
    padding: var(--space-xl);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: var(--space-3xl);
    overflow-x: auto;
  }

  .mermaid-container pre {
    margin: 0;
  }

  .mermaid {
    display: flex;
    justify-content: center;
  }

  .calculation-details {
    max-width: 1000px;
    margin: 0 auto;
  }

  .calculation-details h3 {
    text-align: center;
    margin-bottom: var(--space-2xl);
    font-size: var(--font-size-2xl);
  }

  .detail-box {
    background: white;
    padding: var(--space-lg);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .detail-box h4 {
    margin-bottom: var(--space-md);
    color: var(--color-primary);
    font-size: var(--font-size-lg);
  }

  .detail-box ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .detail-box li {
    padding: var(--space-xs) 0;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
    line-height: var(--line-height-relaxed);
  }

  .detail-box strong {
    color: var(--color-text);
    font-weight: var(--font-weight-semibold);
  }

  /* Link styling for tech list */
  .tech-list a {
    color: var(--color-primary);
    text-decoration: none;
    transition: color var(--transition-base);
  }

  .tech-list a:hover {
    color: var(--color-accent);
    text-decoration: underline;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hero-arch h1 {
      font-size: var(--font-size-3xl);
    }

    .architecture-diagram {
      padding: var(--space-md);
      overflow-x: auto;
    }

    .architecture-diagram svg {
      min-width: 800px;
    }

    .flow-step {
      grid-template-columns: 60px 1fr;
    }

    .flow-number {
      width: 48px;
      height: 48px;
      font-size: var(--font-size-xl);
    }

    .perf-metrics {
      grid-template-columns: 1fr 1fr;
    }

    .mermaid-container {
      padding: var(--space-md);
      overflow-x: auto;
    }
  }

  /* Cytoscape Diagram Styles */
  #cy {
    width: 100%;
    height: 900px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    border: 1px solid rgba(0, 102, 238, 0.1);
  }

  .diagram-instructions {
    text-align: center;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
    margin-bottom: var(--space-lg);
    font-style: italic;
  }

  /* Legend & Controls */
  .diagram-controls {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-lg);
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  .legend {
    background: white;
    border-radius: 8px;
    padding: var(--space-md);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 102, 238, 0.1);
  }

  .legend-title {
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-sm);
    margin-bottom: var(--space-sm);
    color: var(--color-text);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .legend-items {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
  }

  .legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .control-buttons {
    display: flex;
    gap: var(--space-sm);
  }

  .control-btn {
    background: white;
    border: 1px solid rgba(0, 102, 238, 0.2);
    border-radius: 8px;
    padding: 8px 16px;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-primary);
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .control-btn:hover {
    background: var(--color-primary);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 102, 238, 0.2);
  }

  .control-btn:active {
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .diagram-controls {
      flex-direction: column;
    }

    .legend {
      width: 100%;
    }

    .control-buttons {
      width: 100%;
      justify-content: center;
    }

    #cy {
      height: 600px;
    }
  }

  /* Database Modal */
  .database-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-lg);
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-content {
    background: white;
    border-radius: 16px;
    padding: var(--space-2xl);
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xl);
    padding-bottom: var(--space-md);
    border-bottom: 2px solid #f0f0f0;
  }

  .modal-header h3 {
    color: var(--color-primary);
    margin: 0;
  }

  .close-modal {
    background: var(--color-primary);
    color: white;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
  }

  .close-modal:hover {
    transform: scale(1.1);
    background: var(--color-accent);
  }

  .collections-grid-modal {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
  }

  .collection-card {
    background: #f8f9fa;
    padding: var(--space-lg);
    border-radius: 8px;
    border: 2px solid #e0e0e0;
    transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .collection-card:hover {
    transform: translateY(-4px);
    border-color: var(--color-primary);
    box-shadow: 0 8px 20px rgba(0, 102, 238, 0.15);
  }

  .collection-card.special {
    border-color: var(--color-accent);
    background: linear-gradient(135deg, #f8f9fa 0%, #f3f0ff 100%);
  }

  .collection-card.special:hover {
    border-color: var(--color-accent);
    box-shadow: 0 8px 20px rgba(147, 131, 251, 0.2);
  }

  .collection-card h4 {
    color: var(--color-text);
    margin: 0 0 var(--space-md) 0;
    font-size: var(--font-size-lg);
  }

  .collection-card.special h4 {
    color: var(--color-accent);
  }

  .collection-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .collection-card li {
    padding: var(--space-xs) 0;
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
  }

  .collection-card code {
    background: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Monaco', 'Courier New', monospace;
    font-size: 12px;
    color: var(--color-primary);
  }

  .storage-pattern {
    background: #fff3e0;
    border: 2px solid #f57c00;
    border-radius: 8px;
    padding: var(--space-lg);
  }

  .storage-pattern h4 {
    color: #f57c00;
    margin: 0 0 var(--space-sm) 0;
  }

  .storage-pattern p {
    margin: 0;
    color: var(--color-text-light);
    line-height: var(--line-height-relaxed);
  }
</style>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    startOnLoad: true,
    theme: 'default',
    themeVariables: {
      fontSize: '14px',
      fontFamily: 'system-ui, -apple-system, sans-serif'
    }
  });
</script>

<script>
  import { initArchitectureDiagram } from '../scripts/architecture-diagram';

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    initArchitectureDiagram();
  });
</script>

